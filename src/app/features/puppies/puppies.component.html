<div class="container flex flex-col gap-y-20">
    <header class="section-header">
        <h2 class="text-h2 text-center">
            <span i18n="@@puppies.title">Nos chiots</span>
        </h2>

        <div class="grid w-full grid-cols-1 gap-8 md:grid-cols-2">
            <div class="flex-col-start gap-4">
                <h3 class="text-h3 mb-4" i18n="@@puppies.header.title">
                    Nos adorables bouledogues français
                </h3>
                <p i18n="@@puppies.header.description">
                    Découvrez nos adorables chiots bouledogues français disponibles à la
                    réservation. Tous nos chiots sont élevés avec amour et attention dans un
                    environnement familial.
                </p>
                <p i18n="@@puppies.header.description2">
                    Chaque chiot est issu de parents sélectionnés pour leur santé, leur tempérament
                    et leur conformité aux standards de la race. Nous mettons tout en œuvre pour
                    vous offrir des chiots en parfaite santé et bien socialisés.
                </p>
                <p i18n="@@puppies.header.description3">
                    Nos chiots sont disponibles à partir de 8 semaines, âge légal minimum pour la
                    cession d'un chiot. Ils sont vendus avec un certificat de bonne santé, un carnet
                    de santé à jour, une puce électronique et une garantie écrite.
                </p>
                <div class="mt-4 flex gap-4">
                    <a [routerLink]="routes.reservation.path" class="btn btn-primary">
                        <span i18n="@@puppies.header.reservation">Réserver un chiot</span>
                    </a>
                    <a [routerLink]="routes.about.path" class="btn btn-outline">
                        <span i18n="@@puppies.header.contact">Nous contacter</span>
                    </a>
                </div>
            </div>

            <div class="flex-center min-w-sm relative h-full w-full">
                <app-cloudinary-image
                    class="relative size-full"
                    [sizes]="'(max-width: 768px) 100vw, 50vw'"
                    inputClass="mask mask-heart object-cover object-top"
                    publicId="frenchie-hero_mtujt9"
                    [isPriority]="true"
                    alt="Frenchie picture"
                    [isFilled]="true"
                />
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 gap-8 lg:grid-cols-4">
        <!-- Sidebar avec filtres -->
        <aside class="lg:col-span-1">
            <div class="sticky top-24">
                <app-puppy-filters [availableColors]="availableColors()" />
            </div>
        </aside>

        <!-- Contenu principal -->
        <main class="lg:col-span-3">
            <!-- Barre de contrôle (tri et résultats) -->
            <div
                class="mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center"
            >
                <!-- Informations sur les résultats -->
                <div class="text-base-content/70 text-sm">
                    @if (puppyStore.isPuppiesLoading()) {
                        <span i18n="@@puppies.loading">Chargement...</span>
                    } @else if (puppyStore.filteredPuppies().length > 0) {
                        {{ puppyStore.filteredPuppies().length }}
                        <span i18n="@@puppies.found">chiots trouvés</span>
                        @if (puppyStore.hasActiveFilters()) {
                            (
                            <span i18n="@@puppies.filtered">filtrés</span>
                            )
                        }
                    } @else {
                        <span i18n="@@puppies.none">Aucun chiot trouvé</span>
                    }
                </div>

                <!-- Options de tri -->
                <div class="flex items-center gap-2">
                    <label class="select select-sm">
                        <span class="label text-sm" i18n="@@puppies.sort">Trier par:</span>

                        <select [value]="sortKey()" (change)="onSortChange($event)">
                            <option value="name-asc" i18n="@@puppies.sort.name-asc">
                                Nom (A-Z)
                            </option>
                            <option value="name-desc" i18n="@@puppies.sort.name-desc">
                                Nom (Z-A)
                            </option>
                            <option value="price-asc" i18n="@@puppies.sort.price-asc">
                                Prix (croissant)
                            </option>
                            <option value="price-desc" i18n="@@puppies.sort.price-desc">
                                Prix (décroissant)
                            </option>
                            <option value="birthDate-desc" i18n="@@puppies.sort.age-asc">
                                Plus jeunes
                            </option>
                            <option value="birthDate-asc" i18n="@@puppies.sort.age-desc">
                                Plus âgés
                            </option>
                        </select>
                    </label>
                </div>
            </div>

            <!-- Liste des chiots -->
            <app-loading-state [state]="puppyStore.puppies()">
                <ng-template let-state>
                    @if (paginatedPuppies().length > 0) {
                        <!-- Grille des chiots -->
                        <div
                            id="puppies-grid"
                            class="mb-8 grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3"
                        >
                            @for (puppy of paginatedPuppies(); track puppy.id) {
                                <app-puppy-card
                                    [puppyData]="puppy"
                                    [showPrice]="true"
                                    [showAge]="true"
                                    [showViewButton]="true"
                                    [showReserveButton]="true"
                                    class="h-full"
                                />
                            }
                        </div>

                        <!-- Pagination -->
                        <app-pagination
                            [currentPageInput]="currentPage()"
                            [totalCountInput]="puppyStore.filteredPuppies().length"
                            [pageSizeInput]="pageSize()"
                            [showPageSizeSelector]="true"
                            (pageChange)="onPageChange($event)"
                            (pageSizeChange)="onPageSizeChange($event)"
                        />
                    } @else {
                        <!-- État vide -->
                        <div class="py-12 text-center">
                            <div
                                class="icon-[carbon--query] text-base-content/30 mx-auto mb-4 text-6xl"
                            ></div>

                            <h3 class="text-base-content mb-2 text-xl font-semibold">
                                <span i18n="@@puppies.empty.title">Aucun chiot trouvé</span>
                            </h3>

                            <p class="text-base-content/70 mb-6">
                                @if (puppyStore.hasActiveFilters()) {
                                    <span i18n="@@puppies.empty.filtered">
                                        Essayez de modifier vos critères de recherche
                                    </span>
                                } @else {
                                    <span i18n="@@puppies.empty.general">
                                        Aucun chiot n'est actuellement disponible
                                    </span>
                                }
                            </p>

                            @if (puppyStore.hasActiveFilters()) {
                                <button class="btn btn-primary" (click)="clearFilters()">
                                    <span i18n="@@puppies.empty.clear-filters">
                                        Effacer les filtres
                                    </span>
                                </button>
                            }
                        </div>
                    }
                </ng-template>

                <ng-template #error let-errorMessage>
                    <div class="alert alert-error shadow-lg">
                        <i class="icon-[carbon--close-outline] text-2xl"></i>
                        <div>
                            <h3 class="font-bold" i18n="@@puppies.error.title">
                                Erreur de chargement
                            </h3>
                            <div class="text-xs">{{ errorMessage }}</div>
                        </div>
                        <button class="btn btn-sm" (click)="puppyStore.loadAllPuppies()">
                            <span i18n="@@puppies.error.retry">Réessayer</span>
                        </button>
                    </div>
                </ng-template>

                <ng-template #loading>
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3">
                        @for (skeleton of skeletonArray; track $index) {
                            <div
                                class="card bg-base-100 border-base-content/10 shadow-base-content/10 border shadow-lg"
                            >
                                <div class="bg-base-200 skeleton aspect-[3/2] rounded-t-lg"></div>
                                <div class="card-body">
                                    <div class="bg-base-200 skeleton mb-2 h-6 rounded"></div>
                                    <div class="bg-base-200 skeleton mb-4 h-4 w-3/4 rounded"></div>
                                    <div class="mb-4 flex gap-2">
                                        <div class="bg-base-200 skeleton h-6 w-16 rounded"></div>
                                        <div class="bg-base-200 skeleton h-6 w-20 rounded"></div>
                                    </div>
                                    <div class="bg-base-200 skeleton h-8 rounded"></div>
                                </div>
                            </div>
                        }
                    </div>
                </ng-template>
            </app-loading-state>
        </main>
    </div>

    <section class="section-content bg-base-100 rounded-lg">
        <h3 class="text-h3 text-center" i18n="@@puppies.nextLitters.sectionTitle">
            Prochaines portées
        </h3>

        <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
            @for (litter of nextLitters; track litter.expectedDate) {
                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="card-title font-serif" i18n="@@puppies.nextLitters.title">
                            Portée prévue en {{ litter.expectedDate }}
                        </h3>

                        <p i18n="@@puppies.nextLitters.description">
                            Une portée est prévue pour {{ litter.expectedDate }} entre notre femelle
                            {{ litter.female }} et notre mâle {{ litter.male }}. Les chiots seront
                            disponibles à partir de {{ litter.releaseDate }}.
                        </p>

                        <div class="card-actions justify-end">
                            <a
                                [routerLink]="routes.reservation.path"
                                class="btn btn-primary btn-sm"
                                i18n="@@puppies.nextLitters.reserve"
                            >
                                Pré-réserver
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>

    <section class="section-content rounded-lg">
        <h3 class="text-h3 text-center" i18n="@@puppies.faq.title">Questions fréquentes</h3>

        <div class="flex flex-col gap-4">
            @for (faq of faq; track faq.question) {
                <div class="collapse-plus collapse-plus::after collapse">
                    <input type="radio" name="faq-accordion" [checked]="$index === 0" />
                    <div class="collapse-title font-serif text-xl font-medium">
                        {{ faq.question }}
                    </div>
                    <div class="collapse-content">
                        <p>
                            {{ faq.answer }}
                        </p>
                    </div>
                </div>
            }
        </div>
    </section>

    <section class="section-content bg-primary/10 rounded-lg">
        <h3 class="text-h3 text-center" i18n="@@puppies.contact.title">
            Prêt à accueillir un bouledogue français ?
        </h3>

        <p class="mx-auto mb-6 max-w-2xl" i18n="@@puppies.contact.description">
            Contactez-nous dès aujourd'hui pour en savoir plus sur nos chiots disponibles ou pour
            réserver une visite de notre élevage. Nous serons ravis de vous accueillir et de vous
            présenter nos bouledogues.
        </p>

        <div class="flex flex-wrap justify-center gap-4">
            <a [routerLink]="routes.about.path" class="btn btn-outline">
                <span i18n="@@puppies.contact.contactUs">Nous contacter</span>
            </a>
            <a [routerLink]="routes.reservation.path" class="btn btn-primary">
                <span i18n="@@puppies.contact.reserve">Réserver un chiot</span>
            </a>
        </div>
    </section>
</div>
